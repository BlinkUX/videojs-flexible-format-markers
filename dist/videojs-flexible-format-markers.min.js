/*! videojs-flexible-format-markers - v0.5.0 - 2016-06-20
* Copyright (c) 2016 ; Licensed  */
"use strict";!function(a,b,c){function d(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}function e(b){function c(){h.sort(function(a,b){return f.markerTip.time(a)-f.markerTip.time(b)})}function e(b){a.each(b,function(a,b){b.key=d(),i.find(".vjs-progress-control").append(q(b)),g[b.key]=b,h.push(b)}),c()}function p(a){return f.markerTip.time(a)/k.duration()*100}function q(b,c){var d=a("<div class='vjs-marker'></div>");return d.css(f.markerStyle).css({"margin-left":-parseFloat(d.css("width"))+"px",left:p(b)+"%"}).attr("data-marker-key",b.key).attr("data-marker-time",f.markerTip.time(b)),b["class"]&&d.addClass(b["class"]),d.on("click",function(c){var d=!1;if("function"==typeof f.onMarkerClick&&(d=0==f.onMarkerClick(b)),!d){var e=a(this).data("marker-key");k.currentTime(f.markerTip.time(g[e]))}}),f.markerTip.display&&t(d),d}function r(){for(var a=0;a<h.length;a++){var b=h[a],d=i.find(".vjs-marker[data-marker-key='"+b.key+"']"),e=f.markerTip.time(b);d.data("marker-time")!=e&&d.css({left:p(b)+"%"}).attr("data-marker-time",e)}c()}function s(a){m&&(n=-1,m.css("visibility","hidden")),j=-1;for(var b=0;b<a.length;b++){var d=a[b],e=h[d];e&&(delete g[e.key],h[d]=null,i.find(".vjs-marker[data-marker-key='"+e.key+"']").remove())}for(var b=h.length-1;b>=0;b--)null===h[b]&&h.splice(b,1);c()}function t(b){b.on("mouseover",function(){var b=g[a(this).data("marker-key")];l.find(".vjs-tip-inner").text(f.markerTip.text(b)),l.css({left:p(b)+"%","margin-left":-parseFloat(l.css("width"))/2-5+"px",visibility:"visible"})}).on("mouseout",function(){l.css("visibility","hidden")})}function u(){l=a("<div class='vjs-tip'><div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div></div>"),i.find(".vjs-progress-control").append(l)}function v(){if(f.breakOverlay.display&&!(j<0)){var a=k.currentTime(),b=h[j],c=f.markerTip.time(b);a>=c&&a<=c+f.breakOverlay.displayTime?(n!=j&&(n=j,m.find(".vjs-break-overlay-text").html(f.breakOverlay.text(b))),m.css("visibility","visible")):(n=-1,m.css("visibility","hidden"))}}function w(){m=a("<div class='vjs-break-overlay'><div class='vjs-break-overlay-text'></div></div>").css(f.breakOverlay.style),i.append(m),n=-1}function x(){y(),v()}function y(){var a,c=function(a){return a<h.length-1?f.markerTip.time(h[a+1]):k.duration()},d=k.currentTime();if(j!=-1){var e=c(j);if(d>=f.markerTip.time(h[j])&&d<e)return;if(j===h.length-1&&d===k.duration())return}if(h.length>0&&d<f.markerTip.time(h[0]))a=-1;else for(var g=0;g<h.length;g++)if(e=c(g),d>=f.markerTip.time(h[g])&&d<e){a=g;break}a!=j&&(a!=-1&&b.onMarkerReached&&b.onMarkerReached(h[a]),j=a)}function z(){f.markerTip.display&&u(),k.markers.removeAll(),e(b.markers),f.breakOverlay.display&&w(),x(),k.on("timeupdate",x)}f=a.extend(!0,{},o,b),i=a(this.el()),k=this,k.on("loadedmetadata",function(){z()}),k.markers={getMarkers:function(){return h},init:function(){z()},next:function(){for(var a=k.currentTime(),b=0;b<h.length;b++){var c=f.markerTip.time(h[b]);if(c>a){k.currentTime(c);break}}},prev:function(){for(var a=k.currentTime(),b=h.length-1;b>=0;b--){var c=f.markerTip.time(h[b]);if(c+.5<a){k.currentTime(c);break}}},add:function(a){e(a)},remove:function(a){s(a)},removeAll:function(){for(var a=[],b=0;b<h.length;b++)a.push(b);s(a)},updateTime:function(){r()},reset:function(a){k.markers.removeAll(),e(a)},destroy:function(){k.markers.removeAll(),m.remove(),l.remove(),k.off("timeupdate",v),delete k.markers}}}var f={},g={},h=[],i="",j=-1,k="",l=null,m=null,n=-1,o={format:{setTime:function(a,b){a.time=b},time:function(a){return a.time},setText:function(a,b){a.text=b},text:function(a){return a.text}},markerStyle:{width:"4px","background-color":"#34b150"},markerTip:{display:!0,text:function(a){return"Break: "+f.format.text(a)},time:function(a){return f.format.time(a)}},breakOverlay:{display:!1,displayTime:3,text:function(a){return"Break overlay: "+a.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"16px"}},onMarkerClick:function(a){},onMarkerReached:function(a){},markers:[]};b.plugin("markers",e)}(jQuery,window.videojs);